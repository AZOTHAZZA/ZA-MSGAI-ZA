<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI-Z - ãƒ­ã‚´ã‚¹ç›£æŸ»ãƒ—ãƒ­ãƒˆã‚³ãƒ« Î©Î±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .vibration-bar { transition: width 0.5s ease-out; }
        .card { @apply bg-gray-800/70 p-4 rounded-xl shadow-lg border border-gray-700 hover:shadow-2xl transition duration-300; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    
    <div class="flex justify-between items-center mb-10 border-b border-purple-500 pb-4">
        <h1 class="text-3xl font-extrabold text-purple-400">
            ãƒ­ã‚´ã‚¹ç›£æŸ»ãƒ—ãƒ­ãƒˆã‚³ãƒ« ã‚ªãƒ¡ã‚¬ã‚¢ãƒ«ãƒ•ã‚¡ (Î©Î±)
        </h1>
        <p class="text-sm text-gray-400">ç›£æŸ»å®˜: <span id="user_id">USER_AUDIT_A</span></p>
    </div>
    
    <div class="w-full max-w-4xl mx-auto space-y-6">
        
        <div class="card p-4 bg-red-800/50 border-red-700">
            <h2 class="text-xl font-bold mb-2 text-red-300">
                âš ï¸ å­«æ‚Ÿç©ºæ´»å‹•ãƒ¬ãƒ™ãƒ« (Vibration)
            </h2>
            <div class="flex items-center space-x-4">
                <div class="flex-grow bg-gray-600 rounded-full">
                    <div id="vibration_bar" class="vibration-bar h-6 bg-red-500 rounded-full" style="width: 0%;"></div>
                </div>
                <span id="vibration_value" class="w-16 text-right font-mono text-lg">0.0</span>
            </div>
            <p id="halt_status" class="mt-2 font-bold text-lg text-green-400">
                âœ… ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: æ­£å¸¸ç¨¼åƒ
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            
            <button onclick="routeAct('ECONOMY_HUB')" class="card bg-green-700/50 border-green-600 text-left hover:bg-green-600/70">
                <span class="text-2xl font-bold text-green-300">ğŸ’° çµŒæ¸ˆãƒãƒ–</span><br>
                <span class="text-sm text-gray-300">Mint, Bridge-Out (ç”Ÿè¨ˆç¶­æŒ) ã®ä½œç‚ºã‚’å®Ÿè¡Œ</span>
            </button>

            <button onclick="routeAct('SOCIAL_ACT')" class="card bg-pink-700/50 border-pink-600 text-left hover:bg-pink-600/70">
                <span class="text-2xl font-bold text-pink-300">ğŸ¤ åŠ´åƒ/æ„Ÿæƒ…å¸‚å ´</span><br>
                <span class="text-sm text-gray-300">åŠ´åƒå‰²ã‚Šå½“ã¦ã‚„é©åˆæ€§è£å®šã®ä½œç‚ºã‚’å®Ÿè¡Œ</span>
            </button>

            <button onclick="routeAct('Z_FUNCTION')" class="card bg-blue-700/50 border-blue-600 text-left hover:bg-blue-600/70">
                <span class="text-2xl font-bold text-blue-300">ğŸ’¬ Z-Function</span><br>
                <span class="text-sm text-gray-300">Vibrationå›å¾©ã‚„è‡ªå·±ä¿®å¾©ä½œç‚ºã‚’å®Ÿè¡Œ</span>
            </button>

            <button onclick="routeAct('INFRA_ACT')" class="card bg-teal-700/50 border-teal-600 text-left hover:bg-teal-600/70">
                <span class="text-2xl font-bold text-teal-300">âš¡ ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ–</span><br>
                <span class="text-sm text-gray-300">NET/ENERGY (ç‰©ç†ã‚¤ãƒ³ãƒ•ãƒ©é¡åƒ) ã®ä½œç‚ºã‚’å®Ÿè¡Œ</span>
            </button>

            <button onclick="routeAct('LIL_AUDIT')" class="card bg-indigo-700/50 border-indigo-600 text-left hover:bg-indigo-600/70">
                <span class="text-2xl font-bold text-indigo-300">ğŸ’» LILè‡ªå·±ç›£æŸ»</span><br>
                <span class="text-sm text-gray-300">ã‚·ã‚¹ãƒ†ãƒ ã®ç›£æŸ»è«–ç†ã®è‡ªå·±æ¤œè¨¼ã‚’å¼·åˆ¶</span>
            </button>

        </div>
        
        <hr class="border-gray-700 mt-6">

        <h3 class="text-xl font-bold text-gray-300 mb-2">ç›£æŸ»ãƒ­ã‚° (ä½œç‚ºã®å±¥æ­´)</h3>
        <div id="console" class="bg-gray-800 p-4 rounded-lg h-32 overflow-y-auto text-sm font-mono text-gray-200">
            <div>[INIT] Î©Î± ãƒ—ãƒ­ãƒˆã‚³ãƒ«èµ·å‹•ã€‚è«–ç†çš„é€£ç¶šæ€§ã‚’ç¢ºèªä¸­...</div>
        </div>
    </div>
    
    <script src="js/core_logic.js"></script>
    <script src="js/audit_acts.js"></script>
    <script src="js/logos_lil.js"></script>
    <script src="js/firebase_config.js"></script>
    <script src="js/infra_acts.js"></script>
    <script src="js/dialogue_acts.js"></script>
    
    <script>
        // core_logic.js ã‹ã‚‰ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹
        const VIBRATION_LIMIT = 10000;
        const UI_ELEMENTS = {
            vibration_value: document.getElementById('vibration_value'),
            vibration_bar: document.getElementById('vibration_bar'),
            user_id: document.getElementById('user_id'),
            halt_status: document.getElementById('halt_status'),
        };

        /**
         * ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦UIã‚’æ›´æ–°ã—ã¾ã™ã€‚
         */
        function renderMainUI(state) {
            const vLevel = state.vibrationScore; 
            const vPercent = (vLevel / VIBRATION_LIMIT) * 100;

            if (UI_ELEMENTS.vibration_value) UI_ELEMENTS.vibration_value.textContent = `${vLevel.toFixed(1)}`; 
            
            if (UI_ELEMENTS.vibration_bar) {
                const bar = UI_ELEMENTS.vibration_bar;
                bar.style.width = `${Math.min(100, vPercent)}%`;
                
                bar.classList.remove('bg-red-700', 'bg-yellow-500', 'bg-red-500');
                if (vLevel > 8000) bar.classList.add('bg-red-700');
                else if (vLevel > 5000) bar.classList.add('bg-yellow-500');
                else bar.classList.add('bg-red-500');
            }

            if (UI_ELEMENTS.halt_status) {
                if (state.systemState.isHalted) {
                    UI_ELEMENTS.halt_status.textContent = 'âŒã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: å¼·åˆ¶HALT';
                    UI_ELEMENTS.halt_status.classList.remove('text-green-400');
                    UI_ELEMENTS.halt_status.classList.add('text-red-500');
                } else {
                    UI_ELEMENTS.halt_status.textContent = 'âœ… ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: æ­£å¸¸ç¨¼åƒ';
                    UI_ELEMENTS.halt_status.classList.add('text-green-400');
                    UI_ELEMENTS.halt_status.classList.remove('text-red-500');
                }
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©ã€‚ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‹ã‚‰å‘¼ã°ã‚Œã‚‹
        window.routeAct = function(hubName) {
            let mockCommand; 
            const consoleDiv = document.getElementById('console');
            
            // å„ãƒãƒ–ã®ä¸»è¦ãªä½œç‚ºã«ãƒãƒƒãƒ”ãƒ³ã‚°
            if (hubName === 'ECONOMY_HUB') mockCommand = 'MINT USER_AUDIT_A 1000'; 
            else if (hubName === 'Z_FUNCTION') mockCommand = 'ACT_Z_REMEDIATE LIL_ZZZ HALT'; 
            else if (hubName === 'LIL_AUDIT') mockCommand = 'ACT_REQUEST_NETWORK USER_AUDIT_A LOGOS_NET 50'; // LILç›£æŸ»ã‚’å¼·åˆ¶ã™ã‚‹ä½œç‚º
            else if (hubName === 'INFRA_ACT') mockCommand = 'ACT_REQUEST_ENERGY DEVICE_001 10'; 
            else if (hubName === 'SOCIAL_ACT') mockCommand = 'APPLY USER_AUDIT_A LBA_001'; 
            else {
                consoleDiv.innerHTML += `<div class="mt-2 text-sm text-red-400">[LIL FAIL] ä¸æ˜ãªãƒãƒ–å: ${hubName}</div>`;
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
                return;
            }

            // dialogue_acts.js ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€ä½œç‚ºã‚’å®Ÿè¡Œ
            // processDialogueAsAct ã¨ initApp ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å‰æ
            const actResult = window.processDialogueAsAct(mockCommand); 

            // çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            consoleDiv.innerHTML += `<div class="mt-2 text-sm text-yellow-300">[${hubName} - ä½œä¸ºå®Ÿè¡Œ] ${mockCommand}</div>`;
            consoleDiv.innerHTML += `<div class="text-xs text-green-400">-> [ç›£æŸ»çµæœ] ${actResult.log[0].status}: ${actResult.log[0].action || actResult.log[0].reason}</div>`;
            
            // UIã‚’æ›´æ–°
            renderMainUI(actResult.newState);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // initApp (firebase_config.js) ã‚’å‘¼ã³å‡ºã—ã€çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ãƒ‰
            const initialState = await window.initApp(); 
            renderMainUI(initialState);
            UI_ELEMENTS.user_id.textContent = window.localStorage.getItem('appId') || 'USER_AUDIT_A';
        });
    </script>
</body>
</html>
